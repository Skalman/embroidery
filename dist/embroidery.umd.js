!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).embroidery={})}(this,function(t){function e(){return(e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var n,i,r={a:"click",button:"click",form:"submit",input:"input",select:"change",textarea:"input"},o=function(){function t(t,e){this.cache={"data-target":[],"data-action":[]},this.initCalled=!1,this.context=e,this.dataAttr=t.getAttribute("data-controller"),this.targetElements=t.querySelectorAll("[data-target]"),this.actionElements=t.querySelectorAll("[data-action]"),this.updateCache(this.targetElements,"data-target"),this.updateCache(this.actionElements,"data-action"),this.invoke(),this.context[this.dataAttr]&&this.context[this.dataAttr].init&&"function"==typeof this.context[this.dataAttr].init&&!this.initCalled&&(this.context[this.dataAttr].init(this.cache["data-target"]),this.initCalled=!0)}var n=t.prototype;return n.updateCache=function(t,n){var i=this;t.forEach(function(t){var r,o;i.cache=e({},i.cache,((o={})[n]=e({},i.cache[n],((r={})[t.getAttribute(n)]=t,r)),o))})},n.invoke=function(){var t=this;this.actionElements.forEach(function(e){var n=e.getAttribute("data-action");if(!n||""===n)throw new Error("[Embroidery]: An action attribute was specified without an action. Is the action an empty string or missing?");n.split(" ").map(function(n){var i=null,o=null;if(n.includes("->")){var a=n.split("->");i=a[0],o=a[1]}else{var c=e.tagName.toLowerCase();i=r[c],o=n}if(!i)throw new Error("[Embroidery]: Missing event on "+e+", for example click or change.");if(!o)throw new Error("[Embroidery]: Missing function on "+e+". Specify your function in the controller.");e.addEventListener(i,function(){t.context[t.dataAttr][o](t.cache["data-target"])})})})},t}();!function(t){t.Controller="[data-controller]",t.Partial="[data-partial]"}(n||(n={})),function(t){t.Controller="controller",t.Partial="partial"}(i||(i={})),t.Embroidery=function(){function t(){var t;this.cache=((t={})[i.Controller]=[],t[i.Partial]=[],t)}t.start=function(){var e=new t;return e.start(),e};var r=t.prototype;return r.start=function(){try{var t=this;return Promise.resolve(new Promise(function(t){"loading"==document.readyState?document.addEventListener("DOMContentLoaded",t):t()})).then(function(){console.info("Embroidery started."),t.discover(function(e){t.initialize(e)},n.Controller)})}catch(t){return Promise.reject(t)}},r.register=function(t){this.context=e({},t)},r.discover=function(t,e){document.querySelectorAll(e).forEach(function(e){return t(e)})},r.updateCache=function(t,n){var i;this.cache=e({},this.cache,((i={})[n]=[].concat(this.cache[n],[t]),i))},r.initialize=function(t){var e=this,n=t;if(n.dataset)try{Object.keys(n.dataset).forEach(function(t){switch(t){case i.Controller:return e.updateCache(n,i.Controller),new o(n,e.context);case i.Partial:e.updateCache(n,i.Partial);default:throw new Error("Element is not a specified data type, like Controller or Partial")}})}catch(t){setTimeout(function(){throw t},0)}else console.error("An element "+n+" was picked up but could not be initialized")},r.discoverUninitializedControllers=function(t,e){var i=this;return void 0===e&&(e=null),Array.from((e||document).querySelectorAll(n.Controller)).filter(function(t){return!i.cache[n.Controller].includes(t)}).map(function(e){return t(e)})},r.listenForNewUninitializedControllersAtRuntime=function(t){var e=this;return new MutationObserver(function(t){return t.map(function(t){var i=t.addedNodes;i.length>0&&i.forEach(function(t){var i;1===t.nodeType&&((null==t||null==(i=t.parentElement)?void 0:i.closest(n.Controller))||e.discoverUninitializedControllers(function(t){e.initialize(t)},t.parentElement))})})}).observe(document.querySelector("body"),{childList:!0,attributes:!0,subtree:!0})},t}()});
//# sourceMappingURL=embroidery.umd.js.map
