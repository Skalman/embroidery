/* Embroidery 0.0.1
 by Anton Nyman, antonnyman.se */

// prettier-ignore
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Embroidery=e()}(this,function(){"use strict";const t={a:"click",button:"click",form:"submit",input:"input",select:"change",textarea:"input"},e={create:function(e){const i=e.getAttribute("data-controller"),n=e.querySelectorAll("[data-target]"),o=e.querySelectorAll("[data-action]");window[i]&&"function"==typeof window[i].init&&window[i].init();let r={};n.forEach(t=>{r={...r,[t.getAttribute("data-target")]:t}}),o.forEach(e=>{e.getAttribute("data-action").split(" ").map(n=>{let o=null,a=null;if(n.includes("->"))[o,a]=n.split("->");else{const i=e.tagName.toLowerCase();o=t[i],a=n}o&&a||console.error("Missing event or function"),e.addEventListener(o,function(){window[i][a](r)})})})}},i={create:async function(t){const e=t.getAttribute("data-partial"),i=await window.fetch(e,{method:"GET",headers:{"Content-Type":"text/html"}}),n=await i.text();t.insertAdjacentHTML("beforeend",n)}},n={start:async function(){await new Promise(t=>{"loading"==document.readyState?document.addEventListener("DOMContentLoaded",t):t()}),console.info("Embroidery initialized."),this.discoverControllers(t=>{this.initializeController(t)}),this.discoverPartials(async t=>{await this.initializePartial(t)}),this.initializeRuntimeControllers(t=>{this.initializeController(t)})},discoverControllers:function(t){document.querySelectorAll("[data-controller]").forEach(e=>{t(e)})},discoverPartials:function(t){document.querySelectorAll("[data-partial]").forEach(e=>{t(e)})},initializeController:function(t){if(!t.__embr)try{t.__embr=Object.create(e).create(t)}catch(t){setTimeout(()=>{throw t},0)}},initializePartial:async function(t){if(!t.__embr)try{t.__embr=await Object.create(i).create(t)}catch(t){setTimeout(()=>{throw t},0)}},discoverUninitializedControllers:function(t,e=null){const i=(e||document).querySelectorAll("[data-controller]");Array.from(i).filter(t=>void 0===t.__embr).forEach(e=>{t(e)})},initializeRuntimeControllers:function(t){const e=document.querySelector("body");new MutationObserver(t=>{if(!this.pauseMutationObserver)for(let e=0;e<t.length;e++)t[e].addedNodes.length>0&&t[e].addedNodes.forEach(t=>{1===t.nodeType&&(t.parentElement&&t.parentElement.closest("[data-controller]")||this.discoverUninitializedControllers(t=>{this.initializeController(t)},t.parentElement))})}).observe(e,{childList:!0,attributes:!0,subtree:!0})}};return window.Embroidery=n,window.Embroidery.start(),n});
